{% extends "base.html" %}

{% block head %}
<script>
  document.addEventListener('keydown', onKey);

  function onKey(e) {
    if (e.key == 'n') {
      window.location.href = '{{ base_path.path() }}';
    }
    else if (e.key == 'r') {
      window.location.href = '{{ base_path.join(id) }}?fmt=raw';
    }
    else if (e.key == 'y') {
      navigator.clipboard.writeText(window.location.href);
    }
    else if (e.key == 'd') {
      window.location.href = '{{ base_path.join(id) }}?dl={{ ext }}';
    }
    else if (e.key == 'q') {
      window.location.href = '{{ base_path.join(id) }}?fmt=qr';
    }
    else if (e.key == 'p') {
      window.location.href = '{{ base_path.join(id) }}';
    }
    else if (e.key == '?') {
      var overlay = document.getElementById("overlay");

      overlay.style.display = overlay.style.display != "block" ? "block" : "none";
      overlay.onclick = function() {
        if (overlay.style.display == "block") {
          overlay.style.display = "none";
        }
      };
    }

    if (e.keyCode == 27) {
      var overlay = document.getElementById("overlay");

      if (overlay.style.display == "block") {
        overlay.style.display = "none";
      }
    }
  }
</script>
{% endblock %}

{% block nav %}
  {% if can_delete %}
    <li><a href="{{ base_path.join("delete/") }}{{ id }}"><button>delete</button></a></li>
  {% endif %}
    <li><a href="{{ base_path.join(id) }}?dl={{ ext }}"><button>download</button></a></li>
    <li><a href="{{ base_path.join(id) }}?fmt=raw"><button>raw</button></a></li>
    <li><a href="{{ base_path.join(id) }}?fmt=qr"><button>qr</button></a></li>
{% endblock %}

{% block content_post %}
<script>
  while (true) {
    const o = document.querySelector("span.link");
    if (!o) {
      break;
    }
    let l = o.nextSibling;
    let link = o.innerHTML;
    while(l != null && l.tagName == "SPAN" && l.classList.contains("link")) {
      let prevL = l;
      l = l.nextSibling;
      link += prevL.innerText;
      prevL.remove();
    }
    o.setAttribute("href", link);
    o.innerText = link;
	o.className = "";
    o.outerHTML = o.outerHTML.replace(/^<span(.*)span>$/, "<a$1a>");
  }
</script>
{% endblock %}
